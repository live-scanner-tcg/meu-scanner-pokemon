<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner Local (Sem Custo)</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .preview-box { width: 100%; max-width: 400px; height: 300px; border: 2px solid #3B4CCA; border-radius: 15px; margin: auto; overflow: hidden; background: #000; position: relative; }
        #imgPreview { width: 100%; height: 100%; object-fit: contain; display: none; }
        .btn { display: block; width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-blue { background: #3B4CCA; color: white; }
        #status { margin-top: 20px; color: #FFCB05; font-weight: bold; }
    </style>
</head>
<body>

    <h2>Scanner Admin (Local)</h2>
    <div class="preview-box">
        <img id="imgPreview">
        <span id="label">ðŸ“· Foto da Carta</span>
    </div>

    <label for="fileInput" class="btn btn-blue">TIRAR FOTO</label>
    <input type="file" id="fileInput" accept="image/*" capture="environment" style="display:none">

    <div id="status"></div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const imgPreview = document.getElementById('imgPreview');
        const status = document.getElementById('status');

        fileInput.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            status.innerText = "âŒ› Carregando imagem...";
            imgPreview.src = URL.createObjectURL(file);
            imgPreview.style.display = "block";
            document.getElementById('label').style.display = "none";

            status.innerText = "ðŸ” Lendo carta (aguarde 5-10s)...";

            // O Tesseract processa tudo no seu celular
            Tesseract.recognize(file, 'eng', {
                logger: m => { if(m.status === 'recognizing text') status.innerText = `Lendo: ${Math.round(m.progress * 100)}%`; }
            }).then(({ data: { text } }) => {
                console.log("Texto:", text);
                
                // Procura o padrÃ£o de nÃºmero da carta (ex: 045/180)
                const match = text.match(/\d{3}\/\d{3}/);
                const result = match ? match[0] : "NÃºmero nÃ£o detectado";

                status.innerHTML = `âœ… FIM!<br><br>Detectado: <span style="font-size:24px">${result}</span><br><br><small>Texto bruto: ${text.substring(0,50)}...</small>`;
            }).catch(err => {
                status.innerText = "Erro ao processar.";
                console.error(err);
            });
        };
    </script>
</body>
</html>